# cnv_simulator

## Simulating CNV profiles for testing

`generate_cnv_profiles.py`
* For generation of random profiles with small gains/losses
* REQUIRES:
    * `chr_lengths.csv` -> File containing names of each chromosome and their lengths, from normal cell BAM files being used.

`assign_cnv_profile_cells.py`
`run_assign_cnv_profile_cells.slurm`
* Assigning baseline cells and picking new cells to use for gains, saves in a "cell_profile"
* REQUIRES
    * `all_normal_cells.csv` -> File containing all available normal cells, including the group they are stored in.
    * CNV profile file, either as generated by `generate_cnv_profiles.py` or in the same format with columns: clone, chr, start, end, state, copy_number, size, cell_barcode, cell_group

`make_baseline_bam.slurm`
* Generate baseline bam file from normal cell bams based on CNV profile

`sample_cnv_reads.py`
`run_sample_cnv_reads.py`
* Running read sampling, renaming cells, normalize back to baseline library size


## Organization of outputs/data
* Base synthetic bams directory (e.g. `synthetic_bams_2`) contains everything that is generated in pipeline
    * Sub-directory for each example name (e.g. `minitest_c2_2`)
        * Generated from `generate_cnv_profiles.py`
            * `{sample_name}_cnv_profile.tsv`
        * Generated from `assign_cnv_profile_cells.py`
            * `{sample_name}_cell_profile.tsv`
        * Generated from `make_baseline_bam.slurm`
            * `{sample_name}_baseline_cells.bam`
            * `{sample_name}_baseline_cells.bam.bai`
        * Generated from `sample_cnv_reads.slurm`
            * `{sample_name}_unnormalized_cnv.bam`
            * `{sample_name}_final_cnv.bam`
            * `{sample_name}_final_sorted_cnv.bam`
            * `{sample_name}_final_sorted_cnv.bam.bai`
        * Log files